{% extends 'base.html' %}

{% block content %}
<div class="container mt-5">
    <h1 class="text-center text-primary">مدیریت اطلاعات</h1>

    <!-- بخش کلینیک‌ها -->
    <section class="management-section">
        <h2>
            کلینیک‌ها 
            <a href="{% url 'about:add_clinic' %}" class="btn btn-add">+ افزودن کلینیک</a>
        </h2>
        <button class="dropbtn" onclick="toggleDropdown('clinicDropdown', 'servicesSection')">انتخاب کلینیک</button>
        <div id="clinicDropdown" class="dropdown-content">
            {% for clinic in clinics %}
                <a href="{% url 'about:detail_clinic' clinic.id %}">{{ clinic.name }}</a>
            {% empty %}
                <span class="no-data">هیچ کلینیکی ثبت نشده است.</span>
            {% endfor %}
        </div>
    </section>

    <!-- بخش خدمات -->
    <section id="servicesSection" class="management-section">
        <h2>
            خدمات 
            <a href="{% url 'about:add_service' %}" class="btn btn-add">+ افزودن خدمت</a>
        </h2>
        <button class="dropbtn" onclick="toggleDropdown('serviceDropdown')">انتخاب خدمت</button>
        <div id="serviceDropdown" class="dropdown-content">
            {% for service in services %}
                <a href="{% url 'about:detail_service' service.id %}">{{ service.title }}</a>
            {% empty %}
                <span class="no-data">هیچ خدمتی ثبت نشده است.</span>
            {% endfor %}
        </div>
    </section>

    <!-- بخش ساعات کاری -->
    <section class="management-section">
        <h2>
            ساعات کاری
            <a href="{% url 'contact:add_workinghours' %}" class="btn btn-add">+ افزودن ساعت کاری</a>
        </h2>
        
        <!-- دکمه کشویی برای انتخاب ساعت کاری -->
        <button class="dropbtn" onclick="toggleDropdown('workingHoursDropdown')">انتخاب ساعت کاری</button>
        
        <!-- محتوای کشویی -->
        <div id="workingHoursDropdown" class="dropdown-content">
            {% for wh in working_hours %}
                <a href="{% url 'contact:detail_workinghours' wh.id %}" class="working-hour-item">
                    <span class="day-label">{{ wh.get_day_display }}</span>:
                    
                    {% if wh.morning_start and wh.morning_end %}
                        <span class="working-time">
                            {{ wh.morning_start }}:00 - {{ wh.morning_end }}:00
                        </span>
                    {% else %}
                        <span class="off-time">تعطیل در صبح</span>
                    {% endif %}
                    
                    {% if wh.evening_start and wh.evening_end %}
                        <span class="working-time">
                            | {{ wh.evening_start }}:00 - {{ wh.evening_end }}:00
                        </span>
                    {% else %}
                        <span class="off-time">| تعطیل در عصر</span>
                    {% endif %}
                </a>
            {% empty %}
                <span class="no-data">هیچ ساعت کاری ثبت نشده است.</span>
            {% endfor %}
        </div>
    </section>


    <!-- بخش پزشکان -->
    <section class="management-section">
        <h2>
            پزشکان 
            <a href="{% url 'about:add_doctor' %}" class="btn btn-add">+ افزودن پزشک</a>
        </h2>
        <button class="dropbtn" onclick="toggleDropdown('doctorDropdown')">انتخاب پزشک</button>
        <div id="doctorDropdown" class="dropdown-content">
            {% for doctor in doctors %}
                <a href="{% url 'about:detail_doctor' doctor.id %}">
                    {{ doctor.user.first_name }} {{ doctor.user.last_name }}
                </a>
            {% empty %}
                <span class="no-data">هیچ پزشکی ثبت نشده است.</span>
            {% endfor %}
        </div>
    </section>

</div>

<!-- استایل -->
<style>
    .container {
        max-width: 800px;
        margin: auto;
        padding: 20px;
        background: #ffffff;
        border-radius: 8px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
    }
    h1 {
        text-align: center;
        color: #007bff;
        font-weight: bold;
    }
    .management-section {
        margin-bottom: 20px;
        transition: margin-bottom 0.3s ease;
    }
    h2 {
        display: flex;
        justify-content: space-between;
        align-items: center;
        color: #333;
        font-size: 1.5em;
        border-bottom: 2px solid #007bff;
        padding-bottom: 10px;
        margin-bottom: 15px;
    }
    .btn {
        padding: 8px 14px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        text-decoration: none;
        font-size: 14px;
        transition: all 0.3s ease;
    }
    .btn-add {
        background: #28a745;
        color: white;
    }
    .btn:hover {
        opacity: 0.85;
        transform: scale(1.05);
    }

    /* طراحی کشویی */
    .dropbtn {
        width: 100%;
        padding: 10px;
        font-size: 16px;
        background-color: #007bff;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        text-align: left;
        transition: all 0.3s ease;
    }
    .dropdown-content {
        display: none;
        position: relative;
        width: 100%;
        background-color: #f9f9f9;
        border-radius: 5px;
        box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1);
        max-height: 200px;
        overflow-y: auto;
        margin-top: 5px;
        transition: all 0.3s ease;
    }
    .dropdown-content a {
        display: block;
        padding: 10px;
        text-decoration: none;
        color: #333;
        transition: background 0.3s ease;
    }
    .dropdown-content a:hover {
        background: #007bff;
        color: white;
    }
    .no-data {
        display: block;
        padding: 10px;
        text-align: center;
        color: #888;
    }
    .show {
        display: block;
    }
</style>

<!-- جاوااسکریپت -->
<script>
    function toggleDropdown(dropdownId, sectionId = null) {
        let dropdown = document.getElementById(dropdownId);
        let section = sectionId ? document.getElementById(sectionId) : null;
        let allDropdowns = document.querySelectorAll('.dropdown-content');

        // بستن کشویی‌های دیگر
        allDropdowns.forEach(function (drop) {
            if (drop.id !== dropdownId) {
                drop.classList.remove('show');
            }
        });

        // نمایش یا مخفی کردن کشویی
        dropdown.classList.toggle('show');

        // وقتی لیست باز شود، بخش بعدی به پایین برود
        if (section) {
            if (dropdown.classList.contains('show')) {
                section.style.marginTop = dropdown.offsetHeight + "px";
            } else {
                section.style.marginTop = "0px";
            }
        }
    }

    // بستن کشویی وقتی بیرون از آن کلیک شود
    window.onclick = function(event) {
        if (!event.target.matches('.dropbtn')) {
            let dropdowns = document.querySelectorAll('.dropdown-content');
            dropdowns.forEach(function(dropdown) {
                dropdown.classList.remove('show');
            });

            // برگرداندن فاصله‌ها به حالت اولیه
            let sections = document.querySelectorAll('.management-section');
            sections.forEach(section => section.style.marginTop = "0px");
        }
    }
</script>

{% endblock %}
