{% extends 'base.html' %}
{% load static %}

{% block title %} خدمات {% endblock %}

{% block extra_static %}
    <link rel="stylesheet" href="{% static 'service/css/service.css' %}">
    <link rel="stylesheet" href="{% static 'service/css/instagram-icons.css' %}"> <!-- فایل استایل جدید -->
{% endblock %}

{% block content %}
<div class="container py-5">
    
    <!-- Page Header - Modern Style -->
    <header class="service-header mb-5">
        <div class="container-fluid px-0">
            <div class="row g-4 align-items-center">
                <div class="col-lg-8">
                    <div class="hero-content pe-lg-4">
                        <h1 class="display-3 fw-extrabold gradient-text-animated mb-4">
                            <span class="icon-shape bg-primary-soft rounded-circle me-3">
                                <i class="fas fa-heartbeat text-primary fs-2"></i>
                            </span>
                            تجربه درمانی استثنایی
                        </h1>
                        <div class="border-start border-3 border-primary ps-4">
                            <p class="lead text-secondary fs-4 mb-0">
                                مرکز تخصصی خدمات دندان پزشکی با استانداردهای جهانی<br>
                                ترکیبی از دانش روز و تجربه‌ی چندین ساله
                            </p>
                        </div>
                    </div>
                </div>
                
                {% if user.is_authenticated and user.is_doctor or user.is_superuser %}
                <div class="col-lg-4">
                    <div class="d-flex justify-content-lg-end justify-content-center">
                        <a href="{% url 'service:add_service' %}" 
                        class="btn btn-primary btn-hover-scale px-5 py-3 rounded-pill shadow-primary-lg">
                            <i class="fas fa-plus-circle fa-beat-fade me-2"></i>
                            ایجاد خدمت جدید
                        </a>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
    </header>

    <!-- Services List -->
    <section class="services-list">
        {% for service in services %}
        <article class="service-item mb-5 {% cycle 'animate-left' 'animate-right' %}" 
                data-aos="{% cycle 'fade-right' 'fade-left' %}">
            <div class="service-card shadow-sm rounded-4 overflow-hidden transition-hover {% if forloop.counter|divisibleby:2 %}reverse-layout{% endif %}">
                <!-- Service Image Container -->
                <div class="service-image-container position-relative">
                    <figure class="service-image m-0 h-100">
                        <img src="{{ service.image.url }}"
                            class="img-fluid object-fit-cover w-100 h-100"
                            alt="{{ service.title }}"
                            loading="lazy">
                        <div class="image-overlay gradient-overlay"></div>
                    </figure>
                    <!-- Arrow Button -->
                    <button class="btn btn-arrow rounded-circle position-absolute" 
                            aria-label="نمایش جزئیات">
                        <i class="fas {% if forloop.counter|divisibleby:2 %}fa-arrow-left{% else %}fa-arrow-right{% endif %}"></i>
                    </button>
                </div>

                <!-- Service Content Container -->
                <div class="service-content-container bg-light">
                    <div class="p-4 p-lg-5 w-100">
                        <header class="d-flex justify-content-between align-items-start mb-4">
                            <h2 class="h3 fw-bold text-primary mb-0">{{ service.title }}</h2>
                        </header>
                        <div class="service-description mb-4 text-truncate-multiline">
                            <p class="text-muted lh-lg mb-0">{{ service.description }}</p>
                        </div>
                    </div>
                </div>

                <!-- Service Actions (Always Visible) -->
                {% if user.is_authenticated and user.is_doctor or user.is_superuser %}
                <div class="service-actions position-absolute d-flex gap-2">
                    <a href="{% url 'service:update_service' service.id %}" 
                    class="btn btn-outline-primary btn-sm rounded-circle transition-hover"
                    data-bs-toggle="tooltip" 
                    data-bs-placement="top" 
                    title="ویرایش خدمت">
                        <i class="fas fa-edit"></i>
                    </a>
                    <button class="btn btn-outline-danger btn-sm rounded-circle transition-hover"
                            data-bs-toggle="modal" 
                            data-bs-target="#deleteModal-{{ service.id }}"
                            title="حذف خدمت">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
                {% endif %}

                <!-- Delete Modal -->
                {% if user.is_authenticated and user.is_doctor or user.is_superuser %}
                <div class="modal fade" 
                    id="deleteModal-{{ service.id }}" 
                    tabindex="-1" 
                    aria-labelledby="deleteModalLabel-{{ service.id }}" 
                    aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content">
                            <div class="modal-header bg-danger text-white">
                                <h5 class="modal-title" id="deleteModalLabel-{{ service.id }}">تأیید حذف</h5>
                                <button type="button" class="btn-close btn-close-white" 
                                        data-bs-dismiss="modal" 
                                        aria-label="بستن"></button>
                            </div>
                            <form method="post" action="{% url 'service:remove_service' service.id %}">
                                {% csrf_token %}
                                <div class="modal-body text-center">
                                    <p class="mb-3">
                                        آیا مطمئن هستید که می‌خواهید خدمت <strong>{{ service.title }}</strong> را حذف کنید؟
                                    </p>
                                    <p class="text-muted small">این عمل قابل بازگشت نیست!</p>
                                </div>
                                <div class="modal-footer justify-content-center">
                                    <button type="button" class="btn btn-secondary rounded-pill px-4" 
                                            data-bs-dismiss="modal">
                                        انصراف
                                    </button>
                                    <button type="submit" class="btn btn-danger rounded-pill px-4">
                                        حذف
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                {% endif %}
            </div>
        </article>
        {% empty %}
        <div class="col-12">
            <div class="empty-state text-center py-5">
                <img src="{% static 'images/empty-service.svg' %}" 
                    class="mb-4" 
                    width="200" 
                    alt="خدمتی یافت نشد" 
                    loading="lazy">
                <h4 class="text-muted fw-bold">خدمتی یافت نشد!</h4>
                <p class="text-muted">لطفاً بعداً دوباره بررسی کنید یا خدمتی اضافه کنید</p>
            </div>
        </div>
        {% endfor %}
    </section>
</div>
{% endblock %}

{% block extra_js %}
    <script src="{% static 'service/js/service.js' %}"></script>
{% endblock %}