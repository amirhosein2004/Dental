{% extends 'base.html' %}
{% load static i18n %}
{% load compress %}

{% block title %} بروز رسانی مفاله {% endblock %}

{% block extra_static %}
{% compress css %}
    <link rel="stylesheet" href="{% static 'blog/css/create_update_blog.css' %}">
{% endcompress %}
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
{% endblock %}

{% block content %}
<div class="container py-5">
    <h2 class="mb-5 text-primary text-center fw-bold" style="font-size: 2.5rem;">
        {% if form.instance.pk %}
            {% trans "ویرایش پست" %}
        {% else %}
            {% trans "ایجاد بلاگ جدید" %}
        {% endif %}
    </h2>
    
    <form method="post" enctype="multipart/form-data" class="rtl-form needs-validation shadow p-4 rounded bg-light" novalidate id="blogForm">
        {% csrf_token %}
        
        <!-- Title Field -->
        <div class="form-group mb-4">
            <label for="{{ form.title.id_for_label }}" class="form-label fw-bold fs-5 text-dark">{{ form.title.label }}</label>
            {{ form.title }}
            {% if form.title.errors %}
                <div class="invalid-feedback d-block">
                    {% for error in form.title.errors %}
                        <span>{{ error }}</span>
                    {% endfor %}
                </div>
            {% endif %}
        </div>

        <!-- Categories Field -->
        <div class="form-group mb-4">
            <label class="form-label fw-bold fs-5 text-dark">{{ form.categories.label }}</label>
            <div class="category-list d-flex flex-wrap gap-3">
                {% for category in form.categories %}
                    <div class="form-check category-item {% if category.data.selected %}active{% endif %}">
                        {{ category.tag }}
                        <label for="{{ category.id_for_label }}" class="form-check-label">
                            {{ category.choice_label }}
                        </label>
                    </div>
                {% endfor %}
            </div>
            {% if form.categories.errors %}
                <div class="invalid-feedback d-block">
                    {% for error in form.categories.errors %}
                        <span>{{ error }}</span>
                    {% endfor %}
                </div>
            {% endif %}
        </div>

        <!-- Content Field (CKEditor) -->
        <div class="form-group mb-4">
            <label for="{{ form.content.id_for_label }}" class="form-label fw-bold fs-5 text-dark">{{ form.content.label }}</label>
            {{ form.content }}
            {% if form.content.errors %}
                <div class="invalid-feedback d-block">
                    {% for error in form.content.errors %}
                        <span>{{ error }}</span>
                    {% endfor %}
                </div>
            {% endif %}
        </div>

        <!-- Image Field with Preview -->
        <div class="form-group mb-4">
            <label for="{{ form.image.id_for_label }}" class="form-label fw-bold fs-5 text-dark">{{ form.image.label }}</label>
            <div class="custom-file position-relative">
                {{ form.image }}
            </div>
            <small class="form-text text-muted">{% trans "فرمت‌های مجاز: JPG, PNG" %}</small>
            {% if form.instance.image %}
                <div class="mt-3 image-preview" id="currentImage">
                    <img src="{{ form.instance.image.url }}" alt="تصویر فعلی" class="img-thumbnail" style="max-height: 300px;">
                </div>
            {% endif %}
            <div class="mt-3 image-preview" id="imagePreview" style="display: none;">
                <img src="#" alt="پیشنمایش تصویر" class="img-thumbnail" id="imagePreviewImg" style="max-height: 300px;">
            </div>
            {% if form.image.errors %}
                <div class="invalid-feedback d-block">
                    {% for error in form.image.errors %}
                        <span>{{ error }}</span>
                    {% endfor %}
                </div>
            {% endif %}
        </div>

        <!-- Submit Button -->
        <div class="d-grid">
            <button type="submit" class="btn btn-primary btn-lg fw-bold" style="background-color: #007bff; border-color: #007bff;">
                <i class="fas fa-save me-2"></i>{% trans "ذخیره بلاگ" %}
            </button>
        </div>
    </form>
</div>
{% endblock %}

{% block extra_js %}
    {{ form.media }}
    {% compress js %}
    <script src="{% static 'blog/js/create_update_blog.js' %}" defer></script>
    {% endcompress %}
{% endblock %}