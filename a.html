{% extends 'base.html' %}
{% load static %}

{% block extra_static %}

    <link rel="stylesheet" href="{% static 'css/about.css' %}">

{% endblock %}

{% block content %}

{% endblock %}

{% block extra_js %}

{% endblock %}


















{% extends 'base.html' %}

{% block content %}

<div class="dashboard-container">
  <!-- Sidebar -->
  <div class="sidebar">
    <ul>
      <li><a href="#" class="menu-link active" data-target="profile-section">ğŸ“ Ù¾Ø±ÙˆÙØ§ÛŒÙ„ Ù¾Ø²Ø´Ú©</a></li>
      <li><a href="#" class="menu-link" data-target="password-section">ğŸ”‘ ØªØºÛŒÛŒØ± Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±</a></li>
      <li><a href="#" class="menu-link" data-target="blog-section">ğŸ“š Ø¨Ù„Ø§Ú¯â€ŒÙ‡Ø§ÛŒ Ù…Ù†</a></li>
      <li><a href="#" class="menu-link" data-target="gallery-section">ğŸ–¼ï¸ Ú¯Ø§Ù„Ø±ÛŒ Ù…Ù†</a></li>
    </ul>
  </div>

  <!-- Main Content -->
  <div class="content">
    <!-- Profile Section -->
    <div id="profile-section" class="content-section active">
      <h2 class="section-title">ğŸ‘¨âš•ï¸ Ù¾Ø±ÙˆÙØ§ÛŒÙ„ Ù¾Ø²Ø´Ú©</h2>
      
      <!-- Sub-menu for Profile -->
      <div class="sub-menu">
        <ul>
          <li><a href="#" class="sub-menu-link active" data-target="account-info">ğŸ” Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø±ÛŒ</a></li>
          <li><a href="#" class="sub-menu-link" data-target="self-intro">ğŸ“ Ù…Ø¹Ø±ÙÛŒ Ø®ÙˆØ¯</a></li>
          <li><a href="#" class="sub-menu-link" data-target="social-media">ğŸŒ Ø´Ø¨Ú©Ù‡â€ŒÙ‡Ø§ÛŒ Ø§Ø¬ØªÙ…Ø§Ø¹ÛŒ</a></li>
        </ul>
      </div>

      <!-- Profile Update Form -->
      <form id="profile-form" enctype="multipart/form-data">
        {% csrf_token %}
        <!-- Account Information Sub-section -->
        <div id="account-info" class="sub-content-section active">
          <div class="profile-info">
            <div class="profile-image-container">
              {% if doctor.user.image %}
                <img id="profile-preview" src="{{ doctor.user.image.url }}" alt="Ø¹Ú©Ø³ Ù¾Ø±ÙˆÙØ§ÛŒÙ„" class="profile-image" style="max-width: 150px; border-radius: 50%;">
              {% else %}
                <img id="profile-preview" src="/media/users/default.png" alt="Ø¹Ú©Ø³ Ù¾ÛŒØ´â€ŒÙØ±Ø¶" class="profile-image" style="max-width: 150px; border-radius: 50%;">
              {% endif %}
              <label for="id_image">Ø§Ù†ØªØ®Ø§Ø¨ Ø¹Ú©Ø³ Ø¬Ø¯ÛŒØ¯:</label>
              {{ user_form.image }}
            </div>
            <p><strong>ğŸ‘¤ Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ:</strong> {{ user_form.username }}</p>
            <p><strong>ğŸ“§ Ø§ÛŒÙ…ÛŒÙ„:</strong> {{ user_form.email }}</p>
            <p><strong>ğŸ‘¨âš•ï¸ Ù†Ø§Ù…:</strong> {{ user_form.first_name }}</p>
            <p><strong>ğŸ·ï¸ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ:</strong> {{ user_form.last_name }}</p>
          </div>
        </div>

        <!-- Self Introduction Sub-section -->
        <div id="self-intro" class="sub-content-section">
          <div class="intro-box">
            <h3>ğŸ“Œ Ù…Ø¹Ø±ÙÛŒ ØªØ®ØµØµÛŒ</h3>
            {{ doctor_form.description }}
          </div>
        </div>

        <!-- Social Links Sub-section -->
        <div id="social-media" class="sub-content-section">
          <div class="social-links">
            <p><strong>Twitter:</strong> {{ doctor_form.twitter }}</p>
            <p><strong>Instagram:</strong> {{ doctor_form.instagram }}</p>
            <p><strong>Telegram:</strong> {{ doctor_form.telegram }}</p>
            <p><strong>LinkedIn:</strong> {{ doctor_form.linkedin }}</p>
          </div>
        </div>

        <!-- Save Button -->
        <div style="margin-top: 1.5rem;">
          <button type="button" id="global-save-btn">ğŸ’¾ Ø°Ø®ÛŒØ±Ù‡ ØªØºÛŒÛŒØ±Ø§Øª</button>
        </div>
      </form>
    </div>

    <!-- Password Change Section -->
    <div id="password-section" class="content-section">
      <h2 class="section-title">ğŸ”‘ ØªØºÛŒÛŒØ± Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±</h2>
      <form id="password-form" method="post" action="{% url 'accounts:change_password' doctor.user.id %}">
        {% csrf_token %}
        {{ password_form.as_p }}
        <button type="submit" class="save-btn">ØªØºÛŒÛŒØ± Ø±Ù…Ø²</button>
      </form>
      <div id="password-messages" style="margin-top: 1rem;"></div> <!-- Ù…Ø­Ù„ Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ -->
    </div>

    <!-- Blog Section -->
    <div id="blog-section" class="content-section">
      <h2 class="section-title">ğŸ“° Ø¢Ø®Ø±ÛŒÙ† Ù…Ù‚Ø§Ù„Ø§Øª</h2>
      <a href="{% url 'blog:create_blog' %}" class="btn btn-primary">â• Ø§ÙØ²ÙˆØ¯Ù† Ù…Ù‚Ø§Ù„Ù‡ Ø¬Ø¯ÛŒØ¯</a>
      {% if blogs %}
        {% for blog in blogs %}
          <div class="blog-post">
            <h4 class="blog-title">{{ blog.title }}</h4>
            <p class="blog-excerpt">{{ blog.content|truncatewords:30 }}</p>
            <a href="{% url 'blog:blog_detail' blog.slug %}" class="read-more">ğŸ“– Ø§Ø¯Ø§Ù…Ù‡ Ù…Ø·Ù„Ø¨ â†’</a>
            <div class="management-buttons">
              <a href="{% url 'blog:update_blog' blog.pk %}" class="btn btn-warning">âœï¸ ÙˆÛŒØ±Ø§ÛŒØ´</a>
              <a href="{% url 'blog:delete_blog' blog.pk %}" class="btn btn-danger" onclick="return confirm('Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ')">ğŸ—‘ Ø­Ø°Ù</a>
            </div>
          </div>
        {% endfor %}
      {% else %}
        <div class="empty-state">
          <p>ğŸ“­ Ù‡Ù†ÙˆØ² Ù…Ù‚Ø§Ù„Ù‡â€ŒØ§ÛŒ Ù…Ù†ØªØ´Ø± Ù†Ú©Ø±Ø¯Ù‡â€ŒØ§ÛŒØ¯!</p>
        </div>
      {% endif %}
    </div>

    <!-- Gallery Section -->
    <div id="gallery-section" class="content-section">
      <h2 class="section-title">ğŸ–¼ï¸ Ú¯Ø§Ù„Ø±ÛŒ ØªØµØ§ÙˆÛŒØ±</h2>
      <a href="{% url 'gallery:add_gallery' %}" class="btn btn-primary">â• Ø§ÙØ²ÙˆØ¯Ù† ØªØµÙˆÛŒØ± Ø¬Ø¯ÛŒØ¯</a>
      {% if galleries %}
        <div class="gallery-grid">
          {% for gallery in galleries %}
            <div class="gallery-category">
              <h4 class="gallery-title">{{ gallery.category }}</h4>
              <div class="gallery-management">
                <a href="{% url 'gallery:update_gallery' gallery.id %}" class="btn btn-warning">âœï¸ ÙˆÛŒØ±Ø§ÛŒØ´</a>
                <a href="{% url 'gallery:delete_gallery' gallery.id %}" class="btn btn-danger" onclick="return confirm('Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ')">ğŸ—‘ Ø­Ø°Ù</a>
              </div>
              <div class="gallery-images">
                {% for image in gallery.images.all %}
                  <div class="gallery-img">
                    <img src="{{ image.image.url }}" alt="Gallery Image">
                  </div>
                {% endfor %}
              </div>
            </div>
          {% endfor %}
        </div>
      {% else %}
        <div class="empty-state">
          <p>ğŸ“· Ú¯Ø§Ù„Ø±ÛŒ Ø´Ù…Ø§ Ø®Ø§Ù„ÛŒ Ø§Ø³Øª!</p>
        </div>
      {% endif %}
    </div>
  </div>
</div>


<script>
  document.addEventListener("DOMContentLoaded", function() {
    // ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø®Ø´â€ŒÙ‡Ø§ÛŒ Ù…Ù†Ùˆ
    const activateSection = (target) => {
      document.querySelectorAll('.menu-link').forEach(link => link.classList.remove('active'));
      document.querySelectorAll('.content-section').forEach(section => section.classList.remove('active'));
      
      const activeLink = document.querySelector(`.menu-link[data-target="${target}"]`);
      if (activeLink) activeLink.classList.add('active');
      
      const activeSection = document.getElementById(target);
      if (activeSection) activeSection.classList.add('active');
    };
  
    document.querySelectorAll('.menu-link').forEach(link => {
      link.addEventListener('click', function(e) {
        e.preventDefault();
        activateSection(this.dataset.target);
      });
    });
  
    // Ù…Ø¯ÛŒØ±ÛŒØª Ø³Ø§Ø¨â€ŒÙ…Ù†ÙˆÙ‡Ø§
    const subMenuLinks = document.querySelectorAll('.sub-menu-link');
    if (subMenuLinks.length) {
      subMenuLinks.forEach(link => {
        link.addEventListener('click', function(e) {
          e.preventDefault();
          document.querySelectorAll('.sub-menu-link').forEach(l => l.classList.remove('active'));
          document.querySelectorAll('.sub-content-section').forEach(section => section.classList.remove('active'));
          
          this.classList.add('active');
          const subTarget = this.dataset.target;
          const activeSubSection = document.getElementById(subTarget);
          if (activeSubSection) activeSubSection.classList.add('active');
        });
      });
    }
  
    // Ø§Ø±Ø³Ø§Ù„ ÙØ±Ù… Ù¾Ø±ÙˆÙØ§ÛŒÙ„ Ø¨Ø§ Ø¢Ú˜Ø§Ú©Ø³
    document.getElementById('global-save-btn').addEventListener('click', function(e) {
      e.preventDefault();
      const form = document.getElementById('profile-form');
      const formData = new FormData(form);
  
      fetch("{% url 'dashboard:dashboard_doctor' doctor.pk %}", {
        method: "POST",
        headers: {
          "X-CSRFToken": formData.get('csrfmiddlewaretoken')
        },
        body: formData
      })
      .then(response => {
        if (!response.ok) {
          throw new Error('Network response was not ok');
        }
        return response.text();
      })
      .then(html => {
        document.open();
        document.write(html);
        document.close();
      })
      .catch(error => {
        console.error("Error:", error);
        alert("Ø®Ø·Ø§ÛŒÛŒ Ø±Ø® Ø¯Ø§Ø¯Ù‡ Ø§Ø³Øª.");
      });
    });

    // Ø§Ø±Ø³Ø§Ù„ ÙØ±Ù… ØªØºÛŒÛŒØ± Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø¨Ø§ Ø¢Ú˜Ø§Ú©Ø³ Ùˆ Ù¾Ø±Ø¯Ø§Ø²Ø´ Ù¾Ø§Ø³Ø® HTML
    document.getElementById('password-form').addEventListener('submit', function(e) {
      e.preventDefault();
      const form = this;
      const formData = new FormData(form);
      const messagesDiv = document.getElementById('password-messages');
      messagesDiv.innerHTML = ''; // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ

      fetch("{% url 'accounts:change_password' doctor.user.id %}", {
        method: "POST",
        headers: {
          "X-CSRFToken": formData.get('csrfmiddlewaretoken')
        },
        body: formData
      })
      .then(response => {
        if (response.redirected) {
          // Ø¯Ø± ØµÙˆØ±Øª Ù…ÙˆÙÙ‚ÛŒØª Ùˆ Ø±ÛŒØ¯Ø§ÛŒØ±Ú©Øª
          messagesDiv.innerHTML = '<p style="color: green;">Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø´Ù…Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª ØªØºÛŒÛŒØ± Ú©Ø±Ø¯</p>';
          form.reset(); // Ø±ÛŒØ³Øª Ú©Ø±Ø¯Ù† ÙØ±Ù…
          return null; // Ù†ÛŒØ§Ø²ÛŒ Ø¨Ù‡ Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø¨ÛŒØ´ØªØ± Ù†ÛŒØ³Øª
        }
        if (!response.ok) {
          throw new Error('Network response was not ok');
        }
        return response.text(); // Ú¯Ø±ÙØªÙ† HTML Ø¯Ø± ØµÙˆØ±Øª Ø®Ø·Ø§
      })
      .then(html => {
        if (html) {
          // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø®Ø·Ø§Ù‡Ø§ Ø§Ø² HTML
          const parser = new DOMParser();
          const doc = parser.parseFromString(html, 'text/html');
          const errorLists = doc.querySelectorAll('.errorlist');
          if (errorLists.length > 0) {
            let errorMessages = '<ul style="color: red;">';
            errorLists.forEach(list => {
              list.querySelectorAll('li').forEach(item => {
                errorMessages += `<li>${item.textContent}</li>`;
              });
            });
            errorMessages += '</ul>';
            messagesDiv.innerHTML = errorMessages;
          }
        }
      })
      .catch(error => {
        console.error("Error:", error);
        messagesDiv.innerHTML = '<p style="color: red;">Ø®Ø·Ø§ÛŒÛŒ Ø¯Ø± Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ± Ø±Ø® Ø¯Ø§Ø¯. Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.</p>';
      });
    });
  });
</script>



{% endblock %}